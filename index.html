<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#2dd4bf">
  <title>Ù†Ù‡Ø§Ù† | Nehan Secure</title>
  
  <!-- PWA Manifest -->
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="assets/icon-192.png">

  <!-- LOCAL DEPENDENCIES -->
  <script src="assets/crypto-js.min.js"></script>

  <style>
    /* LOCAL FONT LOADING */
    @font-face {
      font-family: 'Vazirmatn';
      src: url('assets/Vazirmatn.woff2') format('woff2');
      font-weight: normal;
      font-style: normal;
      font-display: swap;
    }

    :root {
      /* Nehan Dark Theme */
      --bg-color: #042f2e;
      --surface: #115e59;
      --surface-highlight: #0f766e;
      --border: #2dd4bf;
      --primary: #2dd4bf;
      --primary-grad: linear-gradient(135deg, #2dd4bf, #0d9488);
      --text-main: #f0fdfa;
      --text-muted: #99f6e4;
      --secure: #fbbf24; 
      --radius: 16px;
      --nav-height: 70px;
    }

    [data-theme="light"] {
      --bg-color: #f0fdfa;
      --surface: #ffffff;
      --surface-highlight: #ccfbf1;
      --border: #99f6e4;
      --primary: #0d9488;
      --primary-grad: linear-gradient(135deg, #14b8a6, #0f766e);
      --text-main: #134e4a;
      --text-muted: #5eead4;
      --secure: #d97706;
    }

    * { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }
    
    body {
      font-family: 'Vazirmatn', Tahoma, sans-serif; /* Uses Local Font */
      background-color: var(--bg-color);
      color: var(--text-main);
      margin: 0; padding: 0;
      min-height: 100vh;
      display: flex; flex-direction: column;
      transition: background 0.3s, color 0.3s;
      padding-bottom: var(--nav-height);
    }

    /* HEADER */
    .app-header {
      padding: 1.5rem 1rem; text-align: center;
      background: var(--surface);
      border-bottom: 1px solid rgba(255,255,255,0.1);
      position: sticky; top: 0; z-index: 10;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    }
    .brand-logo { font-size: 1.8rem; font-weight: 900; display: flex; align-items: center; justify-content: center; gap: 10px; color: var(--primary); }
    
    .container { width: 100%; max-width: 500px; margin: 0 auto; padding: 1.5rem 1rem; flex: 1; }

    /* UI ELEMENTS */
    .tab-content { display: none; animation: slideUp 0.3s ease; }
    .tab-content.active { display: block; }
    @keyframes slideUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    label { display: block; margin-bottom: 0.6rem; font-size: 0.85rem; color: var(--text-muted); opacity: 0.9; }
    input, textarea, select { width: 100%; background: rgba(0,0,0,0.15); border: 1px solid var(--border); color: var(--text-main); padding: 14px; border-radius: var(--radius); font-family: inherit; font-size: 1rem; margin-bottom: 1.2rem; transition: 0.2s; }
    [data-theme="light"] input { background: #f0fdfa; }
    input:focus, textarea:focus { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(45, 212, 191, 0.2); }

    .btn-main { width: 100%; padding: 16px; border-radius: var(--radius); border: none; background: var(--primary-grad); color: #fff; font-weight: 700; font-size: 1rem; cursor: pointer; box-shadow: 0 6px 20px rgba(45, 212, 191, 0.3); transition: 0.2s; display: flex; align-items: center; justify-content: center; gap: 10px; }
    .btn-main:active { transform: translateY(2px); }
    .btn-outline { width: 100%; padding: 12px; border-radius: var(--radius); border: 1px solid var(--border); background: transparent; color: var(--text-main); font-weight: 700; cursor: pointer; margin-top: 10px; opacity: 0.8; }

    .toggle-wrapper { background: rgba(0,0,0,0.1); padding: 5px; border-radius: 50px; display: flex; position: relative; margin-bottom: 2rem; border: 1px solid var(--border); }
    .toggle-btn { flex: 1; text-align: center; padding: 12px; cursor: pointer; z-index: 2; font-weight: 500; font-size: 0.95rem; color: var(--text-muted); transition: 0.3s; }
    .toggle-btn.active { color: var(--text-main); font-weight: bold; }
    .toggle-slider { position: absolute; top: 5px; bottom: 5px; right: 5px; width: calc(50% - 5px); background: var(--primary); border-radius: 50px; transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); z-index: 1; box-shadow: 0 2px 10px rgba(0,0,0,0.2); }

    .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; background: var(--surface); border-top: 1px solid rgba(255,255,255,0.05); display: flex; justify-content: space-around; padding: 12px 0; z-index: 50; padding-bottom: max(12px, env(safe-area-inset-bottom)); box-shadow: 0 -5px 20px rgba(0,0,0,0.1); }
    .nav-item { text-align: center; color: var(--text-muted); font-size: 0.75rem; cursor: pointer; flex: 1; transition: 0.2s; opacity: 0.6; display: flex; flex-direction: column; align-items: center; gap: 5px; }
    .nav-item.active { color: var(--primary); opacity: 1; transform: scale(1.05); }
    .nav-icon { width: 24px; height: 24px; fill: currentColor; }

    .card { background: rgba(255,255,255,0.03); border: 1px solid var(--border); border-radius: var(--radius); padding: 1.5rem; margin-bottom: 1rem; }
    [data-theme="light"] .card { background: #fff; }
    
    .key-display { font-family: monospace; background: rgba(0,0,0,0.2); padding: 15px; border-radius: 10px; word-break: break-all; margin: 15px 0; border: 1px dashed var(--border); text-align: center; color: var(--secure); font-weight: bold; direction: ltr; }
    .result-box { margin-top: 1.5rem; padding: 1.5rem; background: rgba(45, 212, 191, 0.1); border: 1px solid var(--primary); border-radius: var(--radius); text-align: center; display: none; }
    .result-box.error { background: rgba(239, 68, 68, 0.1); border-color: rgba(239, 68, 68, 0.5); color: #fca5a5; }
    .secure-input { border-color: var(--secure) !important; }
    .secure-label { color: var(--secure); font-weight: bold; display: flex; align-items: center; gap: 8px; }
    .svg-icon-sm { width: 16px; height: 16px; fill: currentColor; }
  </style>
</head>
<body>

  <!-- HEADER -->
  <div class="app-header">
    <div class="brand-logo">
      <svg class="nav-icon" style="width:30px;height:30px" viewBox="0 0 24 24"><path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11v8.8z"/></svg>
      <span>Ù†Ù‡Ø§Ù†</span>
    </div>
  </div>

  <div class="container">
    
    <!-- HOME TAB -->
    <div id="tab-home" class="tab-content active">
      <div class="toggle-wrapper">
        <div class="toggle-slider" id="mode-slider"></div>
        <div class="toggle-btn active" onclick="setHomeMode(0)">Ø§Ø±Ø³Ø§Ù„ Ø¬Ø¯ÛŒØ¯</div>
        <div class="toggle-btn" onclick="setHomeMode(1)">Ø¯Ø±ÛŒØ§ÙØª Ù…Ø­ØªÙˆØ§</div>
      </div>

      <!-- Upload -->
      <div id="view-upload">
        <form id="form-upload">
          <label>Ø¹Ù†ÙˆØ§Ù†</label> <input type="text" id="u_title">
          <label>Ù…ØªÙ† Ù…Ø­Ø±Ù…Ø§Ù†Ù‡</label> <textarea id="u_content" rows="6" required placeholder="Ù…ØªÙ†..."></textarea>
          
          <label class="secure-label">
            <svg class="svg-icon-sm" viewBox="0 0 24 24"><path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"/></svg>
            Ú©Ù„ÛŒØ¯ Ø±Ù…Ø²Ù†Ú¯Ø§Ø±ÛŒ Ø´Ø®ØµÛŒ
          </label>
          <input type="password" id="u_custom_key" class="secure-input" placeholder="Ú©Ù„ÛŒØ¯ Ù…Ø­Ù„ÛŒ...">

          <div style="display:flex; gap:10px;">
            <div style="flex:1"><label>Ù¾Ø³ÙˆØ±Ø¯ ÙØ§ÛŒÙ„</label><input type="password" id="u_pass"></div>
            <div style="flex:1"><label>Ø¹Ù…Ø± Ù„ÛŒÙ†Ú©</label><select id="u_life"><option value="12h">12h</option><option value="1d">1d</option><option value="1w">1w</option></select></div>
          </div>
          <button type="submit" id="btn-upload" class="btn-main">Ù‚ÙÙ„ Ùˆ Ø§Ø±Ø³Ø§Ù„</button>
        </form>
        <div id="res-upload" class="result-box"></div>
      </div>

      <!-- Download -->
      <div id="view-download" style="display:none">
        <form id="form-download">
          <label>Ú©Ø¯ Ø±Ù‡Ú¯ÛŒØ±ÛŒ</label>
          <input type="text" id="d_code" style="letter-spacing:10px; text-align:center; font-weight:bold; font-size:1.5rem" maxlength="6" inputmode="numeric" required>
          <div style="display:flex; gap:10px;">
             <div style="flex:1"><label>Ù¾Ø³ÙˆØ±Ø¯ ÙØ§ÛŒÙ„</label><input type="password" id="d_pass"></div>
             <div style="flex:1"><label class="secure-label">Ú©Ù„ÛŒØ¯ Ø´Ø®ØµÛŒ</label><input type="password" id="d_custom_key" class="secure-input"></div>
          </div>
          <button type="submit" id="btn-download" class="btn-main">Ø¯Ø±ÛŒØ§ÙØª Ùˆ Ø¨Ø§Ø²Ú¯Ø´Ø§ÛŒÛŒ</button>
        </form>
        <div id="res-download" class="result-box" style="text-align: right;"></div>
      </div>
    </div>

    <!-- SETTINGS TAB -->
    <div id="tab-settings" class="tab-content">
      <div class="card">
        <h3>Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ù„ÛŒØ¯ Ø§Ù…Ù†ÛŒØªÛŒ</h3>
        <p style="font-size:0.85rem; color:var(--text-muted)">Ú©Ù„ÛŒØ¯ Ø¯Ø± Ø­Ø§ÙØ¸Ù‡ Ù…Ø±ÙˆØ±Ú¯Ø± Ø°Ø®ÛŒØ±Ù‡ Ù…ÛŒØ´ÙˆØ¯.</p>
        <div class="key-display" id="stored-key-display">...</div>
        <button class="btn-main" onclick="generateNewKey()">ØªÙˆÙ„ÛŒØ¯ Ú©Ù„ÛŒØ¯</button>
        <button class="btn-outline" onclick="deleteKey()" style="color:#ef4444; border-color:#ef4444">Ø­Ø°Ù Ú©Ù„ÛŒØ¯</button>
      </div>
      <div class="card">
        <div style="display:flex; justify-content:space-between; align-items:center">
          <span>Ù¾ÙˆØ³ØªÙ‡</span>
          <button class="btn-outline" style="width: auto; margin:0;" onclick="toggleTheme()" id="theme-btn">ØªØºÛŒÛŒØ±</button>
        </div>
      </div>
    </div>

    <!-- ABOUT TAB -->
    <div id="tab-about" class="tab-content">
      <div class="card" style="text-align:center">
        <h3>Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ù†Ù‡Ø§Ù†</h3>
        <p>Ù†Ø³Ø®Ù‡ GitHub PWA</p>
        <p style="color:var(--text-muted); font-size:0.9rem">
          Ø§ÛŒÙ† Ø¨Ø±Ù†Ø§Ù…Ù‡ Ú©Ø§Ù…Ù„Ø§ Ø¯Ø± Ù…Ø±ÙˆØ±Ú¯Ø± Ø´Ù…Ø§ Ø§Ø¬Ø±Ø§ Ù…ÛŒØ´ÙˆØ¯.
        </p>
      </div>
    </div>

  </div>

  <nav class="bottom-nav">
    <div class="nav-item active" onclick="switchTab('home', this)">
      <svg class="nav-icon" viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg> Ø®Ø§Ù†Ù‡
    </div>
    <div class="nav-item" onclick="switchTab('settings', this)">
      <svg class="nav-icon" viewBox="0 0 24 24"><path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg> ØªÙ†Ø¸ÛŒÙ…Ø§Øª
    </div>
    <div class="nav-item" onclick="switchTab('about', this)">
      <svg class="nav-icon" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/></svg> Ø¯Ø±Ø¨Ø§Ø±Ù‡
    </div>
  </nav>

<script>
  // UI LOGIC
  const body = document.body;
  function loadTheme() {
    const saved = localStorage.getItem('theme');
    if(saved === 'light') { body.setAttribute('data-theme', 'light'); document.getElementById('theme-btn').innerText = "Ø­Ø§Ù„Øª ØªØ§Ø±ÛŒÚ©"; }
    else { body.removeAttribute('data-theme'); document.getElementById('theme-btn').innerText = "Ø­Ø§Ù„Øª Ø±ÙˆØ´Ù†"; }
  }
  function toggleTheme() { localStorage.setItem('theme', body.getAttribute('data-theme') === 'light' ? 'dark' : 'light'); loadTheme(); }
  loadTheme();

  function switchTab(id, el) {
    document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
    document.getElementById('tab-' + id).classList.add('active');
    document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
    el.classList.add('active');
  }

  function setHomeMode(idx) {
    document.getElementById('mode-slider').style.transform = idx === 0 ? 'translateX(0)' : 'translateX(-100%)';
    document.querySelectorAll('.toggle-btn').forEach((b, i) => b.classList.toggle('active', i === idx));
    document.getElementById('view-upload').style.display = idx===0 ? 'block':'none';
    document.getElementById('view-download').style.display = idx===1 ? 'block':'none';
  }

  // KEY LOGIC
  function loadKey() {
    const k = localStorage.getItem('user_secret_key');
    const el = document.getElementById('stored-key-display');
    if (k) { el.innerText = k; document.getElementById('u_custom_key').value = k; document.getElementById('d_custom_key').value = k; }
    else { el.innerText = "ØªÙ†Ø¸ÛŒÙ… Ù†Ø´Ø¯Ù‡"; }
  }
  function generateNewKey() {
    const c = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%';
    let r = ''; for(let i=0;i<20;i++) r+=c.charAt(Math.floor(Math.random()*c.length));
    localStorage.setItem('user_secret_key', r); loadKey();
  }
  function deleteKey() { if(confirm("Ø­Ø°Ù Ø´ÙˆØ¯ØŸ")) { localStorage.removeItem('user_secret_key'); loadKey(); } }
  loadKey();

  // API LOGIC (DIRECT)
  document.getElementById('form-upload').addEventListener('submit', async (e) => {
    e.preventDefault();
    const btn = document.getElementById('btn-upload'); 
    const res = document.getElementById('res-upload');
    btn.disabled = true; btn.innerText = '...'; 
    res.style.display = 'none'; res.className = 'result-box';

    try {
      let content = document.getElementById('u_content').value;
      const key = document.getElementById('u_custom_key').value;
      if (key && typeof CryptoJS !== 'undefined') content = "ENC::" + CryptoJS.AES.encrypt(content, key).toString();

      const fd = new FormData();
      fd.append("title_1", document.getElementById('u_title').value);
      fd.append("clipboardvalue_1", content);
      fd.append("password", document.getElementById('u_pass').value);
      fd.append("lifedate", document.getElementById('u_life').value);
      fd.append("canupdate", "on");

      const resp = await fetch('https://pastehub.ir/connector/qsend', { method: 'POST', body: fd });
      const data = await resp.json();
      
      if(data.result === "OK") {
        res.style.display='block';
        res.innerHTML = `Ú©Ø¯: <b style="font-size:1.5rem;display:block">${data.code}</b>`;
        document.getElementById('form-upload').reset(); loadKey();
      } else throw new Error(data.text);
    } catch(err) { res.style.display='block'; res.classList.add('error'); res.innerText = err.message; }
    finally { btn.disabled=false; btn.innerText='Ø§Ø±Ø³Ø§Ù„'; }
  });

  document.getElementById('form-download').addEventListener('submit', async (e) => {
    e.preventDefault();
    const btn=document.getElementById('btn-download'); const res=document.getElementById('res-download');
    btn.disabled=true; btn.innerText='...'; res.style.display='none'; res.classList.remove('error');

    try {
      const fd = new FormData();
      const code = document.getElementById('d_code').value.replace(/-/g, '');
      for(let i=0;i<6;i++) fd.append(`verifycode_${i+1}`, code[i]);
      if(document.getElementById('d_pass').value) fd.append("authpass", document.getElementById('d_pass').value);

      const resp = await fetch('https://pastehub.ir/connector/qverify', { method:'POST', body:fd });
      const data = await resp.json();

      if(data.result === "OK") {
         const p = new DOMParser().parseFromString(data.display, 'text/html');
         let content = p.querySelector('textarea[id^="clipboardvalue_"]')?.value || "";
         const key = document.getElementById('d_custom_key').value;
         
         if(content.startsWith("ENC::")) {
            if(key && typeof CryptoJS !== 'undefined') {
                try {
                    const bytes = CryptoJS.AES.decrypt(content.substring(5), key);
                    const txt = bytes.toString(CryptoJS.enc.Utf8);
                    content = txt || "â›” Ú©Ù„ÛŒØ¯ Ø§Ø´ØªØ¨Ø§Ù‡";
                } catch(e){ content="â›” Ø®Ø·Ø§"; }
            } else content="ğŸ”’ Ø±Ù…Ø² Ø´Ø¯Ù‡";
         }
         res.style.display='block';
         res.innerHTML = `<textarea readonly style="width:100%" rows="5">${content}</textarea>`;
      } else throw new Error(data.text);
    } catch(err) { res.style.display='block'; res.classList.add('error'); res.innerText = err.message; }
    finally { btn.disabled=false; btn.innerText='Ø¯Ø±ÛŒØ§ÙØª'; }
  });
</script>
</body>
</html>